<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hand Gesture Music</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <script src="/ml5.min.js"></script>
  <script src="/p5.sound.min.js"></script>
</head>
<body>
  <script>
    let handpose;
    let video;
    let predictions = [];
    let osc;

    function setup() {
        document.body.addEventListener('click', () => {
    // Setup the oscillator for electronic music
    osc = new p5.Oscillator();
    osc.setType('sine'); // You can experiment with different oscillator types
    osc.amp(0);
    osc.start();
  });



      createCanvas(640, 480);
      video = createCapture(VIDEO);
      video.size(width, height);

      handpose = ml5.handpose(video, modelReady);
      handpose.on("predict", (results) => {
        predictions = results;
      });

      video.hide();

      

      // Setup the oscillator for electronic music
      osc = new p5.Oscillator();
      osc.setType('sine'); // You can experiment with different oscillator types
      osc.amp(0);
      osc.start();
    }

    function modelReady() {
      console.log("Model ready!");
    }

    function draw() {
      background(220);
      translate(width, 0);
      scale(-1, 1);
      image(video, 0, 0, width, height);
      drawMusic();
    }

    function drawMusic() {
      for (let i = 0; i < predictions.length; i++) {
        const prediction = predictions[i];
        for (let j = 0; j < prediction.landmarks.length; j++) {
          const keypoint = prediction.landmarks[j];
          fill(255, 0, 0);
          noStroke();
          ellipse(keypoint[0], keypoint[1], 10, 10);

          // Use hand position to control sound
          let freq = map(keypoint[0], 0, width, 100, 1000);
          let vol = map(keypoint[1], 0, height, 1, 0);
          osc.freq(freq);
          osc.amp(vol, 0.1); // Adjust the ramp time for smooth volume changes
        }
      }
    }
  </script>
</body>
</html>
